---
layout: post
title: å‰ç«¯ç»„ä»¶åŒ–ï¼ˆä¸‰ï¼‰ï¼šæŠ½è±¡å‡ºå…¬å…±ç»„ä»¶ç±»
description: React.js å°ä¹¦æ˜¯ä¸€ä¸ªå¼€æºã€å…è´¹ã€ä¸“ä¸šã€ç®€å•çš„ React.js æ•™ç¨‹ã€‚æœ¬æ–‡æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•ä½¿ç”¨ React.js å®ç°å‰ç«¯ç»„ä»¶åŒ–çš„æ•™ç¨‹çš„ç¬¬ä¸‰éƒ¨åˆ†ï¼Œä»‹ç»äº†å¦‚ä½•æŠ½è±¡å‡ºå…¬å…±ç»„ä»¶ç±»ã€‚
tags: [React.js,React.js å°ä¹¦,æ•™ç¨‹,ç»„ä»¶]
---

<ul style='font-size: 14px; margin-top: -10px;'>
  <li>
    ä½œè€…ï¼š<a href="https://www.zhihu.com/people/hu-zi-da-ha" target="_blank">èƒ¡å­å¤§å“ˆ</a>
  </li>
  <li>
    åŸæ–‡é“¾æ¥ï¼š<a href="http://huziketang.com/books/react{{ page.url }}"> http://huziketang.com/books/react{{ page.url }} </a>
  </li>
  <li>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œä¿ç•™åŸæ–‡é“¾æ¥å’Œä½œè€…ä¿¡æ¯ã€‚</li>
</ul>

ä¸ºäº†è®©ä»£ç æ›´çµæ´»ï¼Œå¯ä»¥å†™æ›´å¤šçš„ç»„ä»¶ï¼Œæˆ‘ä»¬æŠŠè¿™ç§æ¨¡å¼æŠ½è±¡å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ª `Component` ç±»å½“ä¸­ï¼š

```javascript
  class Component {
    setState (state) {
      const oldEl = this.el
      this.state = state
      this.el = this._renderDOM()
      if (this.onStateChange) this.onStateChange(oldEl, this.el)
    }

    _renderDOM () {
      this.el = createDOMFromString(this.render())
      if (this.onClick) {
        this.el.addEventListener('click', this.onClick.bind(this), false)
      }
      return this.el
    }
  }
```

è¿™ä¸ªæ˜¯ä¸€ä¸ªç»„ä»¶çˆ¶ç±» `Component`ï¼Œæ‰€æœ‰çš„ç»„ä»¶éƒ½å¯ä»¥ç»§æ‰¿è¿™ä¸ªçˆ¶ç±»æ¥æ„å»ºã€‚å®ƒå®šä¹‰çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬å·²ç»å¾ˆç†Ÿæ‚‰çš„ `setState`ï¼›ä¸€ä¸ªæ˜¯ç§æœ‰æ–¹æ³• `_renderDOM`ã€‚`_renderDOM` æ–¹æ³•ä¼šè°ƒç”¨ `this.render` æ¥æ„å»º DOM å…ƒç´ å¹¶ä¸”ç›‘å¬ `onClick` äº‹ä»¶ã€‚æ‰€ä»¥ï¼Œç»„ä»¶å­ç±»ç»§æ‰¿çš„æ—¶å€™åªéœ€è¦å®ç°ä¸€ä¸ªè¿”å› HTML å­—ç¬¦ä¸²çš„ `render` æ–¹æ³•å°±å¯ä»¥äº†ã€‚
 
è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„ `mount` çš„æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯æŠŠç»„ä»¶çš„ DOM å…ƒç´ æ’å…¥é¡µé¢ï¼Œå¹¶ä¸”åœ¨ `setState` çš„æ—¶å€™æ›´æ–°é¡µé¢ï¼š

```javascript
  const mount = (component, wrapper) => {
    wrapper.appendChild(component._renderDOM())
    component.onStateChange = (oldEl, newEl) => {
      wrapper.insertBefore(newEl, oldEl)
      wrapper.removeChild(oldEl)
    }
  }
```

è¿™æ ·çš„è¯æˆ‘ä»¬é‡æ–°å†™ç‚¹èµç»„ä»¶å°±ä¼šå˜æˆï¼š

```javascript
  class LikeButton extends Component {
    constructor () {
      this.state = { isLiked: false }
    }

    onClick () {
      this.setState({
        isLiked: !this.state.isLiked
      })
    }

    render () {
      return `
        <button class='like-btn'>
          <span class='like-text'>${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}</span>
          <span>ğŸ‘</span>
        </button>
      `
    }
  }

  mount(new LikeButton(), wrapper)
```

è¿™æ ·è¿˜ä¸å¤Ÿå¥½ã€‚åœ¨å®é™…å¼€å‘å½“ä¸­ï¼Œä½ å¯èƒ½éœ€è¦ç»™ç»„ä»¶ä¼ å…¥ä¸€äº›è‡ªå®šä¹‰çš„é…ç½®æ•°æ®ã€‚ä¾‹å¦‚è¯´æƒ³é…ç½®ä¸€ä¸‹ç‚¹èµæŒ‰é’®çš„èƒŒæ™¯é¢œè‰²ï¼Œå¦‚æœæˆ‘ç»™å®ƒä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œå‘Šè¯‰å®ƒæ€ä¹ˆè®¾ç½®è‡ªå·±çš„é¢œè‰²ã€‚é‚£ä¹ˆè¿™ä¸ªæŒ‰é’®çš„å®šåˆ¶æ€§å°±æ›´å¼ºäº†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™ç»„ä»¶ç±»å’Œå®ƒçš„å­ç±»éƒ½ä¼ å…¥ä¸€ä¸ªå‚æ•° `props`ï¼Œä½œä¸ºç»„ä»¶çš„é…ç½®å‚æ•°ã€‚ä¿®æ”¹ `Component`  çš„æ„é€ å‡½æ•°ä¸ºï¼š

```javascript
...
    constructor (props = {}) {
      this.props = props
    }
...
```

ç»§æ‰¿çš„æ—¶å€™é€šè¿‡ `super(props)` æŠŠ `props` ä¼ ç»™çˆ¶ç±»ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ `this.props` è·å–åˆ°é…ç½®å‚æ•°ï¼š

```javascript
  class LikeButton extends Component {
    constructor (props) {
      super(props)
      this.state = { isLiked: false }
    }

    onClick () {
      this.setState({
        isLiked: !this.state.isLiked
      })
    }

    render () {
      return `
        <button class='like-btn' style="background-color: ${this.props.bgColor}">
          <span class='like-text'>
            ${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}
          </span>
          <span>ğŸ‘</span>
        </button>
      `
    }
  }

  mount(new LikeButton({ bgColor: 'red' }), wrapper)
```

è¿™é‡Œæˆ‘ä»¬ç¨å¾®ä¿®æ”¹äº†ä¸€ä¸‹åŸæœ‰çš„ `LikeButton` çš„ `render` æ–¹æ³•ï¼Œè®©å®ƒå¯ä»¥æ ¹æ®ä¼ å…¥çš„å‚æ•° `this.props.bgColor` æ¥ç”Ÿæˆä¸åŒçš„ `style` å±æ€§ã€‚è¿™æ ·å°±å¯ä»¥è‡ªç”±é…ç½®ç»„ä»¶çš„é¢œè‰²äº†ã€‚

åªè¦æœ‰äº†ä¸Šé¢é‚£ä¸ª `Component` ç±»å’Œ `mount` æ–¹æ³•åŠ èµ·æ¥ä¸è¶³40è¡Œä»£ç å°±å¯ä»¥åšåˆ°ç»„ä»¶åŒ–ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦å†™å¦å¤–ä¸€ä¸ªç»„ä»¶ï¼Œåªéœ€è¦åƒä¸Šé¢é‚£æ ·ï¼Œç®€å•åœ°ç»§æ‰¿ä¸€ä¸‹  `Component` ç±»å°±å¥½äº†ï¼š

```javascript
  class RedBlueButton extends Component {
    constructor (props) {
      super(props)
      this.state = {
        color: 'red'
      }
    }

    onClick () {
      this.setState({
        color: 'blue'
      })
    }

    render () {
      return `
        <div style='color: ${this.state.color};'>${this.state.color}</div>
      `
    }
  }
```

ç®€å•å¥½ç”¨ï¼Œç°åœ¨å¯ä»¥çµæ´»åœ°ç»„ä»¶åŒ–é¡µé¢äº†ã€‚`Component` å®Œæ•´çš„ä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ° [reactjs-in-40](https://github.com/huzidaha/reactjs-in-40)ã€‚

## æ€»ç»“
æˆ‘ä»¬ç”¨äº†å¾ˆé•¿çš„ç¯‡å¹…æ¥è®²ä¸€ä¸ªç®€å•çš„ç‚¹èµçš„ä¾‹å­ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹é‡Œé¢ä¸€ç›´åœ¨ä¼˜åŒ–ç¼–å†™çš„æ–¹å¼ã€‚æœ€åæŠ½ç¦»å‡ºæ¥äº†ä¸€ä¸ªç±»ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„åšç»„ä»¶åŒ–ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹é‡Œé¢æˆ‘ä»¬å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ

ç»„ä»¶åŒ–å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³å‰ç«¯ç»“æ„çš„å¤ç”¨æ€§é—®é¢˜ï¼Œæ•´ä¸ªé¡µé¢å¯ä»¥ç”±è¿™æ ·çš„ä¸åŒçš„ç»„ä»¶ç»„åˆã€åµŒå¥—æ„æˆã€‚

ä¸€ä¸ªç»„ä»¶æœ‰è‡ªå·±çš„æ˜¾ç¤ºå½¢æ€ï¼ˆä¸Šé¢çš„ HTML ç»“æ„å’Œå†…å®¹ï¼‰è¡Œä¸ºï¼Œç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€å’Œè¡Œä¸ºå¯ä»¥ç”±æ•°æ®çŠ¶æ€ï¼ˆstateï¼‰å’Œé…ç½®å‚æ•°ï¼ˆpropsï¼‰å…±åŒå†³å®šã€‚æ•°æ®çŠ¶æ€å’Œé…ç½®å‚æ•°çš„æ”¹å˜éƒ½ä¼šå½±å“åˆ°è¿™ä¸ªç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€ã€‚

å½“æ•°æ®å˜åŒ–çš„æ—¶å€™ï¼Œç»„ä»¶çš„æ˜¾ç¤ºéœ€è¦æ›´æ–°ã€‚æ‰€ä»¥å¦‚æœç»„ä»¶åŒ–çš„æ¨¡å¼èƒ½æä¾›ä¸€ç§é«˜æ•ˆçš„æ–¹å¼è‡ªåŠ¨åŒ–åœ°å¸®åŠ©æˆ‘ä»¬æ›´æ–°é¡µé¢ï¼Œé‚£ä¹Ÿå°±å¯ä»¥å¤§å¤§åœ°é™ä½æˆ‘ä»¬ä»£ç çš„å¤æ‚åº¦ï¼Œå¸¦æ¥æ›´å¥½çš„å¯ç»´æŠ¤æ€§ã€‚

å¥½äº†ï¼Œè¯¾ç¨‹ç»“æŸäº†ã€‚ä½ å·²ç»å­¦ä¼šäº†æ€ä¹ˆä½¿ç”¨ React.js äº†ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å†™äº†ä¸€ä¸ªâ€”â€”å½“ç„¶æˆ‘æ˜¯åœ¨å¼€ç©ç¬‘ï¼Œä½†æ˜¯ä¸Šé¢è¿™ä¸ª `Component` ç±»å…¶å®å’Œ React çš„ `Component` ä½¿ç”¨æ–¹å¼å¾ˆç±»ä¼¼ã€‚æŒæ¡äº†è¿™å‡ èŠ‚çš„è¯¾ç¨‹ï¼Œä½ åŸºæœ¬å°±æŒæ¡äº†åŸºç¡€çš„ React.js çš„æ¦‚å¿µã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹æ­£å¼è¿›å…¥ä¸»é¢˜ï¼Œå¼€å§‹æ­£å¼ä»‹ç» React.jsã€‚ä½ ä¼šå‘ç°ï¼Œæœ‰äº†å‰é¢çš„é“ºå«ï¼Œä¸‹é¢è®²çš„å†…å®¹ç†è§£èµ·æ¥ä¼šç®€å•å¾ˆå¤šäº†ã€‚

* * *

> å› ä¸ºç¬¬ä¸‰æ–¹è¯„è®ºå·¥å…·æœ‰é—®é¢˜ï¼Œå¯¹æœ¬ç« èŠ‚æœ‰ä»»ä½•ç–‘é—®çš„æœ‹å‹å¯ä»¥ç§»æ­¥åˆ° <a target="_blank" href="http://scriptoj.com/category/4/react-js-å°ä¹¦äº¤æµåŒº">React.js å°ä¹¦çš„è®ºå›</a> å‘å¸–ï¼Œæˆ‘ä¼šå›ç­”å¤§å®¶çš„ç–‘é—®ã€‚
